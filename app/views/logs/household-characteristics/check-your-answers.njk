{% extends "layouts/check-answers.njk" %}

{% set householdSize = log[section.id]["number-in-household"] | int %}

{% macro age (is_known, age) %}
{%- if is_known == "true" %}{{ age }}
{% elif is_known == "false" %}Not known
{% else %}<span class="app-!-colour-muted">You didn’t answer this question</span>
{% endif -%}
{% endmacro %}

{% block checkAnswers %}
  {{ rigSummaryCard({
    classes: "govuk-!-margin-bottom-6",
    rows: [{
      key: {
        text: "Number of people in household"
      },
      value: {
        text: log[section.id]["number-in-household"] | textFromInputValue()
      },
      actions: {
        items: [{
          href: sectionPath + "/number-in-household?referrer=" + referrer,
          text: "Change",
          visuallyHiddenText: "number of people in household"
        }]
      }
    }]
  }) }}

  {{ rigSummaryCard({
    classes: "govuk-!-margin-bottom-6",
    titleText: "Lead tenant",
    rows: [{
      key: {
        text: "Age"
      },
      value: {
        text: age(log[section.id]["lead-tenant-age-known"], log[section.id]["lead-tenant-age"])
      },
      actions: {
        items: [{
          href: sectionPath + "/lead-tenant-age?referrer=" + referrer,
          text: "Change",
          visuallyHiddenText: "lead’s tenant age"
        }]
      }
    }, {
      key: {
        text: "Gender identity"
      },
      value: {
        text: log[section.id]["lead-tenant-gender"] | textFromInputValue(data.questions["gender-identity"])
      },
      actions: {
        items: [{
          href: sectionPath + "/lead-tenant-gender?referrer=" + referrer,
          text: "Change",
          visuallyHiddenText: "lead tenant’s gender identity"
        }]
      }
    }, {
      key: {
        text: "Nationality"
      },
      value: {
        text: log[section.id]["lead-tenant-nationality"] | textFromInputValue(data.questions["nationality"])
      },
      actions: {
        items: [{
          href: sectionPath + "/lead-tenant-nationality?referrer=" + referrer,
          text: "Change",
          visuallyHiddenText: "lead tenant’s nationality"
        }]
      }
    }, {
      key: {
        text: "Working situation"
      },
      value: {
        text: log[section.id]["lead-tenant-working-situation"] | textFromInputValue(data.questions["working-situation"])
      },
      actions: {
        items: [{
          href: sectionPath + "/lead-tenant-working-situation?referrer=" + referrer,
          text: "Change",
          visuallyHiddenText: "lead tenant’s working situation"
        }]
      }
    }]
  }) }}

  {% if householdSize > 1 %}
    {% for i in range(1, householdSize) %}
      {% set tenantId = i + 1 | int %}
      {% set tenantKnown = true if log[section.id]["tenant-" + tenantId + "-known"] == "true" %}
      {% set tenantKnownResponse = "Yes" if tenantKnown %}

      {{ rigSummaryCard({
        classes: "govuk-!-margin-bottom-6",
        titleText: "Tenant " + tenantId,
        rows: [{
          key: {
            text: "Details known for tenant " + tenantId
          },
          value: {
            text: tenantKnownResponse or "No"
          },
          actions: {
            items: [{
              href: sectionPath + "/tenant-" + (i + 1) + "-known",
              text: "Change",
              visuallyHiddenText: "whether you know the details for tenant " + (i + 1)
            }]
          }
        }, {
          key: {
            text: "Relationship to lead tenant"
          },
          value: {
            text: log[section.id]["tenant-" + (i + 1) + "-relationship"] | textFromInputValue(data.questions["relationship-to-lead-tenant"])
          },
          actions: {
            items: [{
              href: sectionPath + "/tenant-" + (i + 1) + "-relationship?referrer=" + referrer,
              text: "Change",
              visuallyHiddenText: "relationship to lead tenant"
            }]
          }
        } if tenantKnown, {
          key: {
            text: "Age"
          },
          value: {
            text: age(log[section.id]["tenant-" + (i + 1) + "-age-known"], log[section.id]["tenant-" + (i + 1) + "-age"])
          },
          actions: {
            items: [{
              href: sectionPath + "/tenant-" + (i + 1) + "-age?referrer=" + referrer,
              text: "Change",
              visuallyHiddenText: "tenant’s age"
            }]
          }
        } if tenantKnown, {
          key: {
            text: "Gender identity"
          },
          value: {
            text: log[section.id]["tenant-" + (i + 1) + "-gender"] | textFromInputValue(data.questions["gender-identity"])
          },
          actions: {
            items: [{
              href: sectionPath + "/tenant-" + (i + 1) + "-gender?referrer=" + referrer,
              text: "Change",
              visuallyHiddenText: "tenant’s gender identity"
            }]
          }
        } if tenantKnown, {
          key: {
            text: "Working situation"
          },
          value: {
            text: log[section.id]["tenant-" + (i + 1) + "-working-situation"] | textFromInputValue(data.questions["working-situation"])
          },
          actions: {
            items: [{
              href: sectionPath + "/tenant-" + (i + 1) + "-working-situation?referrer=" + referrer,
              text: "Change",
              visuallyHiddenText: "tenant’s working situation"
            }]
          }
        } if tenantKnown]
      }) }}

    {% endfor %}
  {% endif %}
{% endblock %}
